name: fts-cd-agent

services:
  cd-agent:
    image: ghcr.io/medizininformatik-initiative/fts/clinical-domain-agent:latest@sha256:9efc76f9db94c1096c151252ead0d6595faee74abfb06d3c22e8d3518b05f2ca
    ports: [ ":8080" ]
    networks: [ "agents", "clinical-domain" ]                                              # CI_ONLY
    volumes:
    - ./projects:/app/projects
    - ../deidentifhir/:/app/projects/example/deidentifhir                                  # CI_ONLY
    depends_on:                                                                            # CI_ONLY
      cd-hds:                                                                              # CI_ONLY
        condition: service_healthy                                                         # CI_ONLY
    healthcheck:
      test: [ "CMD", "wget", "-qO-", "http://localhost:8080/actuator/health" ]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 60s
